pc_w_sc_bar <- pzbar(pc_w_sc, m_c, as.matrix(break_dates[2:(m_c+1)]))
mdl_sc_tmp2 <- lm(cpi_comp_all ~ 1 + pc_w_sc_bar)
new_cpi_common2 <- mdl_sc_tmp2$fitted.values
names(new_cpi_common2) <- NULL
cpi_common_sc2 <- data.frame(cbind(date_vec,new_cpi_common2))
colnames(cpi_common_sc) <- c("Date", "cpi_common2")
plot(cpi_common_sc2[,2], type = 'l', col = "red")
lines(cpi_common_sc[,2], type = 'l')
lines(cpi_common_full_samp[,2], type = 'l', col = "blue")
sum((total_cpi_boc[,2]- cpi_common_full_samp[,2])^2)/nrow(total_cpi_boc)
sum((total_cpi_boc[,2]- cpi_common_sc[,2])^2)/nrow(total_cpi_boc)
sum((total_cpi_boc[,2]- cpi_common_sc2[,2])^2)/nrow(total_cpi_boc)
# ---------------------------------------------------------------------------- #
# ---------------------------- COMPARISON --------------------------------------
# ---------------------------------------------------------------------------- #
# CPI-common from BoC vs. One estimated here (note that BoC uses more historical data by imputing pre 1997 data for some variables. Method is unknown)
xdate <- as.Date(total_cpi_boc[,1], "%Y-%m-%d")
plot(xdate, cpi_common_full_samp[,2], type = 'l', xlab="Date", ylab="Percent (%)")
lines(xdate, cpi_common_boc[108:nrow(cpi_common_boc),2], type = 'l', col = "red")
legend(xdate[1], 7, legend=c("CPI-common", "CPI-common-BoC"), col=c("black", "red"), lty=1, cex=0.8)
# CPI-common (estimated here) vs. CPI-common-SC vs. Total-CPI
xdate <- as.Date(total_cpi_boc[,1], "%Y-%m-%d")
plot(xdate,total_cpi_boc[,2], type = 'l', xlab="Date", ylab="Percent (%)")
lines(xdate,cpi_common_full_samp[,2], type = 'l', col = 'blue')
lines(xdate, cpi_common_sc[,2], type = 'l', col = 'green')
for (xd in 2:(length(break_dates)-1)){
abline(v = xdate[break_dates[xd]], col="red", lwd=3, lty=2)
}
legend(xdate[1], 8, legend=c("Total-CPI-BoC", "CPI-common", "CPI-common-SC", "Break dates"), col=c("black", "blue", "green","red"), lty=c(1,1,1,2), cex=0.8)
cpi_common_full_samp_rev <- matrix(NA, nrow = length(cpi_comp_all), ncol = length(cpi_comp_all)-rev_start+1)
for (xr in rev_start:length(cpi_comp_all)){
cpi_comp_inf.pca_tmp <- prcomp(cpi_comp_inf.std[1:xr,], center = FALSE, scale = FALSE)
pc_full_samp_tmp <- cpi_comp_inf.pca_tmp$x[,1:r]
mdl_full_samp_tmp <- lm(cpi_comp_all[1:xr] ~ 1 + pc_full_samp_tmp)
cpi_common_full_samp_rev[1:xr,(xr-rev_start+1)] <- mdl_full_samp_tmp$fitted.values
}
rev_full_samp_tmp <- abs(cpi_common_full_samp_rev[,ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev)[,-ncol(cpi_common_full_samp_rev)]
max(rev_full_samp_tmp[is.na(rev_full_samp_tmp)==FALSE])
rev_full_samp <- diag(abs(cpi_common_full_samp_rev[,ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev)[rev_start:(length(cpi_comp_all)-1),-ncol(cpi_common_full_samp_rev)])
mean(rev_full_samp)
rev_full_samp[which.max(rev_full_samp)]
# over last three years
mean(rev_full_samp[(length(rev_full_samp)-12*3):length(rev_full_samp)])
# over last two years
mean(rev_full_samp[(length(rev_full_samp)-12*2):length(rev_full_samp)])
# over last year
mean(rev_full_samp[(length(rev_full_samp)-12*1):length(rev_full_samp)])
cpi_common_full_samp_rev_boc_2013 <- cpi_common_full_samp_rev[1:167,1:(167-rev_start+1)]
rev_2013_tmp <- abs(cpi_common_full_samp_rev_boc_2013[,ncol(cpi_common_full_samp_rev_boc_2013)]-cpi_common_full_samp_rev_boc_2013)[,-ncol(cpi_common_full_samp_rev_boc_2013)]
max(rev_2013_tmp[is.na(rev_2013_tmp)==FALSE])
rev_2013 <- diag(abs(cpi_common_full_samp_rev_boc_2013[,ncol(cpi_common_full_samp_rev_boc_2013)]-cpi_common_full_samp_rev_boc_2013)[rev_start:166,-ncol(cpi_common_full_samp_rev_boc_2013)])
mean(rev_2013)
rev_2013[which.max(rev_2013)]
# over last three years
mean(rev_2013[(length(rev_2013)-12*3):length(rev_2013)])
# over last two years
mean(rev_2013[(length(rev_2013)-12*2):length(rev_2013)])
# over last year
mean(rev_2013[(length(rev_2013)-12*1):length(rev_2013)])
# over last 4 months as in paper
mean(rev_2013[(length(rev_2013)-4):length(rev_2013)])
cpi_common_sc_rev <- matrix(NA, nrow = length(cpi_comp_all), ncol = length(cpi_comp_all)-rev_start+1)
fixed_break_dates <- break_dates[2:(length(break_dates)-1)]
break_ind <- matrix(0,length(cpi_comp_all),1)
break_ind[fixed_break_dates,] <- 1
break_count <- cumsum(break_ind)
xr=120
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:max(regime_dates[xd,2],xr),]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:max(regime_dates[xd,2],xr)]
}
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
new_cpi_common <- c()
(m_tmp+1)
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
cpi_comp_inf_all_regime_ls[[xd]]
cpi_comp_inf_all_regime_ls_tmp[[xd]]
cpi_comp_inf_pca_tmp$x[,1:r]
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
new_cpi_common
new_cpi_common <- c()
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
}
(xr-rev_start+1)
cpi_common_sc_rev[1:xr,(xr-rev_start+1)] <- new_cpi_common
cpi_common_sc_rev <- matrix(NA, nrow = length(cpi_comp_all), ncol = length(cpi_comp_all)-rev_start+1)
fixed_break_dates <- break_dates[2:(length(break_dates)-1)]
break_ind <- matrix(0,length(cpi_comp_all),1)
break_ind[fixed_break_dates,] <- 1
break_count <- cumsum(break_ind)
for (xr in rev_start:138){ #length(cpi_comp_all)){
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:max(regime_dates[xd,2],xr),]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:max(regime_dates[xd,2],xr)]
}
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
# estimate PCA for each regime
new_cpi_common <- c()
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
}
cpi_common_sc_rev[1:xr,(xr-rev_start+1)] <- new_cpi_common
}
xr
View(cpi_common_sc_rev)
xr=139
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
m_tmp
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
xd=1
(m_tmp+1)
regime_dates[xd,1]
max(regime_dates[xd,2],xr)
regime_dates[xd,2]
(xd==(m_tmp+1))
fixed_break_dates
(xd==(m_tmp+1))
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:regime_dates[xd,2],]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:regime_dates[xd,2]]
xd=xd+1
(xd==(m_tmp+1))
xd=1
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:regime_dates[xd,2],]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:regime_dates[xd,2]]
xd=2
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:xr,]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:xr]
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
new_cpi_common <- c()
xd=1
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
new_cpi_common
xd=2
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
if (xd==(m_tmp+1)){
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:xr,]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:xr]
}else{
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:regime_dates[xd,2],]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:regime_dates[xd,2]]
}
}
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
new_cpi_common <- c()
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
}
new_cpi_common
cpi_common_sc_rev[1:xr,(xr-rev_start+1)] <- new_cpi_common
(xr-rev_start+1)
xr
xr=140
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
m_tmp
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
xd=1
(xd==(m_tmp+1))
regime_dates[xd,1]
regime_dates[xd,2]
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:regime_dates[xd,2],]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:regime_dates[xd,2]]
xd=2
(xd==(m_tmp+1))
regime_dates[xd,1]
xr
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:xr,]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:xr]
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
# estimate PCA for each regime
new_cpi_common <- c()
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
}
cpi_common_sc_rev[1:xr,(xr-rev_start+1)] <- new_cpi_common
(xr-rev_start+1)
plot(cpi_common_full_samp_rev, type ="l")
matplot(cpi_common_full_samp_rev, type ="l")
matplot(cpi_common_full_samp_rev[,1:3], type ="l")
matplot(cpi_common_full_samp_rev, type ="l")
matplot(cpi_common_full_samp_rev_boc_2013, type ="l")
rowSums(rev_2013_tmp,na.rm=TRUE)
rowCount(rev_2013_tmp,na.rm=TRUE)
rowCounts(rev_2013_tmp,na.rm=TRUE)
!is.na(rev_2013_tmp)
rowSums(!is.na(rev_2013_tmp))
rowSums(rev_2013_tmp, na.rm=TRUE)/rowSums(!is.na(rev_2013_tmp))
rowSums(rev_2013_tmp, na.rm=TRUE)
rev_2013_tmp
View(cpi_common_full_samp_rev_boc_2013)
View(rev_2013_tmp)
rev_2013_tmp <- abs(cpi_common_full_samp_rev_boc_2013[,ncol(cpi_common_full_samp_rev_boc_2013)]-cpi_common_full_samp_rev_boc_2013)[1:166,-ncol(cpi_common_full_samp_rev_boc_2013)]
max(rev_2013_tmp[is.na(rev_2013_tmp)==FALSE])
rowSums(rev_2013_tmp, na.rm=TRUE)/rowSums(!is.na(rev_2013_tmp))
mean(rowSums(rev_2013_tmp, na.rm=TRUE)/rowSums(!is.na(rev_2013_tmp)))
rev_full_samp_tmp <- abs(cpi_common_full_samp_rev[,ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev)[1:(nrow(cpi_common_full_samp_rev)-1),-ncol(cpi_common_full_samp_rev)]
mean(rowSums(rev_full_samp_tmp, na.rm=TRUE)/rowSums(!is.na(rev_full_samp_tmp)))
rowSums(rev_full_samp_tmp, na.rm=TRUE)/rowSums(!is.na(rev_full_samp_tmp))
cpi_common_sc_rev <- matrix(NA, nrow = length(cpi_comp_all), ncol = length(cpi_comp_all)-rev_start+1)
fixed_break_dates <- break_dates[2:(length(break_dates)-1)]
break_ind <- matrix(0,length(cpi_comp_all),1)
break_ind[fixed_break_dates,] <- 1
break_count <- cumsum(break_ind)
for (xr in rev_start:255){ #length(cpi_comp_all)){
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
if (xd==(m_tmp+1)){
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:xr,]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:xr]
}else{
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:regime_dates[xd,2],]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:regime_dates[xd,2]]
}
}
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
# estimate PCA for each regime
new_cpi_common <- c()
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
}
cpi_common_sc_rev[1:xr,(xr-rev_start+1)] <- new_cpi_common
}
xr
xr=256
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
m_tmp
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
xd=1
(xd==(m_tmp+1))
regime_dates[xd,1]
regime_dates[xd,2]
xd=2
(xd==(m_tmp+1))
regime_dates[xd,1]
regime_dates[xd,2]
fixed_break_dates
xd=3
(xd==(m_tmp+1))
xd
regime_dates[xd,1]
regime_dates[xd,2]
xd=4
(xd==(m_tmp+1))
cpi_common_sc_rev <- matrix(NA, nrow = length(cpi_comp_all), ncol = length(cpi_comp_all)-rev_start+1)
fixed_break_dates <- break_dates[2:(length(break_dates)-1)]
break_ind <- matrix(0,length(cpi_comp_all),1)
break_ind[fixed_break_dates,] <- 1
break_count <- cumsum(break_ind)
for (xr in rev_start:length(cpi_comp_all)){
m_tmp <- break_count[xr-h] # last regime must be at least of length h so using number of breaks at time xr - h
cpi_comp_inf_regime_ls_tmp <- list(m_tmp+1)
cpi_comp_inf_all_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
if (xd==(m_tmp+1)){
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:xr,]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:xr]
}else{
cpi_comp_inf_regime_ls_tmp[[xd]] <- cpi_comp_inf[regime_dates[xd,1]:regime_dates[xd,2],]
cpi_comp_inf_all_regime_ls_tmp[[xd]] <- cpi_comp_all[regime_dates[xd,1]:regime_dates[xd,2]]
}
}
cpi_comp_inf_std_regime_ls_tmp <- list(m_tmp+1)
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_std_tmp <- matrix(0, nrow(cpi_comp_inf_regime_ls_tmp[[xd]]), ncol(cpi_comp_inf_regime_ls_tmp[[xd]]))
for (xi in 1:ncol(cpi_comp_inf_regime_ls_tmp[[xd]])){
cpi_comp_inf_std_tmp[,xi] <- (cpi_comp_inf_regime_ls_tmp[[xd]][,xi] - mean(cpi_comp_inf_regime_ls_tmp[[xd]][,xi]))/sd(cpi_comp_inf_regime_ls_tmp[[xd]][,xi])
}
cpi_comp_inf_std_regime_ls_tmp[[xd]] <- cpi_comp_inf_std_tmp
}
# estimate PCA for each regime
new_cpi_common <- c()
for (xd in 1:(m_tmp+1)){
cpi_comp_inf_pca_tmp <- prcomp(cpi_comp_inf_std_regime_ls_tmp[[xd]], center = FALSE, scale = FALSE)
mdl_sc_tmp <- lm(cpi_comp_inf_all_regime_ls_tmp[[xd]] ~ 1 + cpi_comp_inf_pca_tmp$x[,1:r])
new_fit_vals <- mdl_sc_tmp$fitted.values
names(new_fit_vals) <- NULL
new_cpi_common <- c(new_cpi_common, new_fit_vals)
}
cpi_common_sc_rev[1:xr,(xr-rev_start+1)] <- new_cpi_common
}
rev_sc_tmp <- abs(cpi_common_sc_rev[,ncol(cpi_common_sc_rev)]-cpi_common_sc_rev)[1:(nrow(cpi_common_sc_rev)-1),-ncol(cpi_common_sc_rev)]
mean(rowSums(rev_sc_tmp, na.rm=TRUE)/rowSums(!is.na(rev_sc_tmp)))
rowSums(rev_sc_tmp, na.rm=TRUE)/rowSums(!is.na(rev_sc_tmp))
sc_mean_rev <- rowSums(rev_sc_tmp, na.rm=TRUE)/rowSums(!is.na(rev_sc_tmp))
mean(sc_mean_rev)
full_samp_mean_rev <- rowSums(rev_2013_tmp, na.rm=TRUE)/rowSums(!is.na(rev_2013_tmp))
mean(full_samp_mean_rev) #Is this a better measure of revisions?
full_samp_mean_rev <- rowSums(rev_full_samp_tmp, na.rm=TRUE)/rowSums(!is.na(rev_full_samp_tmp))
mean(full_samp_mean_rev) #Is this a better measure of revisions?
plot(sc_mean_rev, type = "l")
lines(full_samp_mean_rev, col = "red")
plot(full_samp_mean_rev, type = "l", col = "red")
lines(sc_mean_rev, col = "green")
plotmat(cpi_common_sc_rev, type ="l")
matplot(cpi_common_sc_rev, type ="l")
plot(full_samp_mean_rev, type = "l", col = "red")
lines(sc_mean_rev, col = "green")
mean(full_samp_mean_rev)
mean(sc_mean_rev)
mean(full_samp_mean_rev)/mean(sc_mean_rev)
full_samp_mean_rev-sc_mean_rev
plot(full_samp_mean_rev-sc_mean_rev, type = 'l')
mean(full_samp_mean_rev-sc_mean_rev)
plot(full_samp_mean_rev-sc_mean_rev, type = 'l')
lineas(total_cpi_boc, col = "red")
plot(total_cpi_boc, type = 'l')
lines(full_samp_mean_rev-sc_mean_rev, col = "red")
plot(total_cpi_boc, type = 'l')
plot(total_cpi_boc[,2], type = 'l')
plot(total_cpi_boc[,2], type = 'l')
lines(full_samp_mean_rev-sc_mean_rev, col = "red")
plot(total_cpi_boc[,2], type = 'l')
lines(full_samp_mean_rev, col = "red")
lines(sc_mean_rev, col = "green")
plot(full_samp_mean_rev, type = "l", col = "red")
lines(sc_mean_rev, col = "green")
full_samp_mean_rev
which.max(full_samp_mean_rev)
xdate[which.max(full_samp_mean_rev)]
cpi_common_full_samp_rev[1:which.max(full_samp_mean_rev),which.max(full_samp_mean_rev)]
(1:which.max(full_samp_mean_rev))
which.max(full_samp_mean_rev)
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),which.max(full_samp_mean_rev)]
(which.max(full_samp_mean_rev)-rev_start+1)
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+2)]
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+3)]
rev_start
(which.max(full_samp_mean_rev)-rev_start
which.max(full_samp_mean_rev)
which.max(full_samp_mean_rev)
which.max(full_samp_mean_rev)-rev_start
which.max(full_samp_mean_rev)-rev_start+3
View(cpi_common_full_samp_rev)
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(1:(which.max(full_samp_mean_rev)+1)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(1:which.max(full_samp_mean_rev)),ncol(cpi_common_full_samp_rev)]
cpi_common_full_samp_rev[(which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(which.max(full_samp_mean_rev)),ncol(cpi_common_full_samp_rev)]
cpi_common_full_samp_rev[which.max(full_samp_mean_rev),]
cpi_common_sc_rev[which.max(full_samp_mean_rev),]
xdate[which.max(full_samp_mean_rev)]
plot(xdate, total_cpi_boc[,2], type = 'l')
lines(xdate,full_samp_mean_rev, col = "red")
lines(xdate[1:(length(xdate)-1)],full_samp_mean_rev, col = "red")
plot(xdate[1:(length(xdate)-1)], total_cpi_boc[1:(length(xdate)-1),2], type = 'l')
lines(xdate[1:(length(xdate)-1)],full_samp_mean_rev, col = "red")
lines(xdate[1:(length(xdate)-1)],sc_mean_rev, col = "green")
matplot(cpi_common_sc_rev, type ="l")
matplot(cpi_common_full_samp_rev, type ="l")
plot(full_samp_mean_rev, type = "l", col = "red")
lines(sc_mean_rev, col = "green")
(mean(full_samp_mean_rev)-mean(sc_mean_rev))/mean(sc_mean_rev)
cpi_common_full_samp_rev[(which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(which.max(full_samp_mean_rev)),ncol(cpi_common_full_samp_rev)]
cpi_common_full_samp_rev[which.max(full_samp_mean_rev),]
cpi_common_sc_rev[which.max(full_samp_mean_rev),]
cpi_common_sc_rev[(which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_sc_rev[(which.max(full_samp_mean_rev)),ncol(cpi_common_full_samp_rev)]
cpi_common_sc_rev[(which.max(full_samp_mean_rev)),ncol(cpi_common_full_samp_rev)]- cpi_common_sc_rev[(which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
cpi_common_full_samp_rev[(which.max(full_samp_mean_rev)),ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev[(which.max(full_samp_mean_rev)),(which.max(full_samp_mean_rev)-rev_start+1)]
plot(xdate[1:(length(xdate)-1)], total_cpi_boc[1:(length(xdate)-1),2], type = 'l')
lines(xdate[1:(length(xdate)-1)],full_samp_mean_rev, col = "red")
lines(xdate[1:(length(xdate)-1)],sc_mean_rev, col = "green")
xdate[which.max(sc_mean_rev)]
which.max(sc_mean_rev)
sc_worst_day <- xdate[which.max(sc_mean_rev)]
fs_worst_day <- xdate[which.max(full_samp_mean_rev)]
sc_worst_day <- xdate[which.max(sc_mean_rev)]
xdate[fs_worst_day]
fs_worst_day <- which.max(full_samp_mean_rev)
xdate[fs_worst_day]
sc_worst_day <- xdate[which.max(sc_mean_rev)]
xdate[sc_worst_day]
sc_worst_day <- which.max(sc_mean_rev)
xdate[sc_worst_day]
sc_worst_day
cpi_common_full_samp_rev[fs_worst_day,(fs_worst_day-rev_start+1)]
cpi_common_full_samp_rev[fs_worst_day, ncol(cpi_common_full_samp_rev)]
cpi_common_full_samp_rev[fs_worst_day, ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev[fs_worst_day,(fs_worst_day-rev_start+1)]
cpi_common_full_samp_rev[sc_worst_day,(sc_worst_day-rev_start+1)]
cpi_common_full_samp_rev[sc_worst_day, ncol(cpi_common_full_samp_rev)]
cpi_common_full_samp_rev[sc_worst_day, ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev[sc_worst_day,(sc_worst_day-rev_start+1)]
cpi_common_sc_rev[fs_worst_day,(fs_worst_day-rev_start+1)]
cpi_common_sc_rev[fs_worst_day,ncol(cpi_common_full_samp_rev)]
cpi_common_sc_rev[fs_worst_day,ncol(cpi_common_full_samp_rev)]- cpi_common_sc_rev[fs_worst_day,(fs_worst_day-rev_start+1)]
cpi_common_sc_rev[sc_worst_day,(sc_worst_day-rev_start+1)]
cpi_common_sc_rev[sc_worst_day,ncol(cpi_common_full_samp_rev)]
cpi_common_sc_rev[sc_worst_day,ncol(cpi_common_full_samp_rev)]- cpi_common_sc_rev[sc_worst_day,(sc_worst_day-rev_start+1)]
cpi_common_full_samp_rev[sc_worst_day, ncol(cpi_common_full_samp_rev)]-cpi_common_full_samp_rev[sc_worst_day,(sc_worst_day-rev_start+1)]
cpi_common_full_samp_rev[sc_worst_day, ncol(cpi_common_full_samp_rev)]
cpi_common_full_samp_rev[sc_worst_day,(sc_worst_day-rev_start+1)]
xdate <- as.Date(total_cpi_boc[,1], "%Y-%m-%d")
plot(xdate,total_cpi_boc[,2], type = 'l', xlab="Date", ylab="Percent (%)")
lines(xdate,cpi_common_full_samp[,2], type = 'l', col = 'blue')
lines(xdate, cpi_common_sc[,2], type = 'l', col = 'green')
for (xd in 2:(length(break_dates)-1)){
abline(v = xdate[break_dates[xd]], col="red", lwd=3, lty=2)
}
legend(xdate[1], 8, legend=c("Total-CPI-BoC", "CPI-common", "CPI-common-SC", "Break dates"), col=c("black", "blue", "green","red"), lty=c(1,1,1,2), cex=0.8)
View(rev_sc_tmp)
sc_out$datevec
sc_out$glob
sc_out$glob[2]-sc_out$glob[1]
sc_out$glob[3]-sc_out$glob[2]
sc_out$glob[4]-sc_out$glob[3]
sc_out$glob[5]-sc_out$glob[4]
sc_out$glob[6]-sc_out$glob[5]
c(sc_out$glob[3]-sc_out$glob[2],sc_out$glob[3]-sc_out$glob[1])
c(sc_out$glob[4]-sc_out$glob[3], sc_out$glob[4]-sc_out$glob[2], sc_out$glob[4]-sc_out$glob[1])
c(sc_out$glob[5]-sc_out$glob[4], sc_out$glob[5]-sc_out$glob[3], sc_out$glob[5]-sc_out$glob[2], sc_out$glob[5]-sc_out$glob[1])
c(sc_out$glob[6]-sc_out$glob[5], sc_out$glob[6]-sc_out$glob[4], sc_out$glob[6]-sc_out$glob[3], sc_out$glob[6]-sc_out$glob[2], sc_out$glob[6]-sc_out$glob[1])
plot(xdate, total_cpi_boc[,2]-cpi_common_full_samp[,2], type = 'l')
plot(xdate, total_cpi_boc[,2]-cpi_common_full_samp[,2], type = 'l', col = "red")
lines(xdate, total_cpi_boc[,2]-cpi_common_sc[,2], type = 'l')
lines(xdate, (total_cpi_boc[,2]-cpi_common_sc[,2])^2, type = 'l')
plot(xdate, (total_cpi_boc[,2]-cpi_common_full_samp[,2])^2, type = 'l', col = "red")
lines(xdate, (total_cpi_boc[,2]-cpi_common_sc[,2])^2, type = 'l')
plot(xdate, total_cpi_boc[,2]-cpi_common_full_samp[,2], type = 'l', col = "red")
lines(xdate, total_cpi_boc[,2]-cpi_common_sc[,2], type = 'l')
setwd("/Users/grodriguezrondon/Documents/res/MC_MS_MSM/MSTest-main")
setwd("/Users/grodriguezrondon/Documents/GitHub/MSTest")
library(MSTest)
detach("package:MSTest", unload=TRUE)
